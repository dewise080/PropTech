<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nearby Amenities Map - 41.009929,28.674937</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    
    <!-- Font Awesome 5 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    
    <!-- Ubuntu Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        html, body { 
            height: 100%; 
            margin: 0; 
            overflow: hidden;
            font-family: 'Ubuntu', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        #map {
            width: 100%;
            height: 100vh;
            position: relative;
            z-index: 1;
        }
        
        .legend {
            position: absolute;
            bottom: 30px;
            left: 10px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .legend-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid white;
            box-shadow: 0 0 3px rgba(0,0,0,0.3);
        }
        
        .info-header {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .info-header h1 {
            margin: 0 0 5px 0;
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }
        
        .info-header p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        .leaflet-popup-content {
            margin: 10px;
        }
        
        .popup-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
            color: #333;
        }
        
        .popup-info {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
        }
        
        .popup-distance {
            font-weight: 600;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="info-header">
        <h1>üìç 41.009929,28.674937</h1>
        <p>Showing amenities within 2500m radius</p>
    </div>
    
    <div class="legend">
        <div class="legend-title">Amenities</div>
        <div class="legend-item">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/4f/Istanbul_Metro_Logo.svg" alt="Metro" style="width: 20px; height: 20px; margin-right: 8px;">
            <span>Metro Stations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #e67e22;"></div>
            <span>Metrobus Stations</span>
        </div>
        <div class="legend-item">
            <div style="background-color: #3498db; width: 20px; height: 20px; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 0 3px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-bus" style="color: white; font-size: 10px;"></i></div>
            <span>Bus Stops</span>
        </div>
        <div class="legend-item">
            <div style="background-color: #f39c12; width: 20px; height: 20px; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 0 3px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-taxi" style="color: white; font-size: 10px;"></i></div>
            <span>Taxi Stands</span>
        </div>
        <div class="legend-item">
            <div style="width: 20px; height: 3px; background-color: #1abc9c; margin-right: 8px; border-radius: 2px;"></div>
            <span>Minibus Lines</span>
        </div>
        <div class="legend-item">
            <div style="background-color: #27ae60; width: 20px; height: 20px; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 0 3px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-shopping-cart" style="color: white; font-size: 10px;"></i></div>
            <span>Grocery Stores</span>
        </div>
        <div class="legend-item">
            <div style="background-color: #9b59b6; width: 20px; height: 20px; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 0 3px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-shopping-cart" style="color: white; font-size: 10px;"></i></div>
            <span>Clothing Stores</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #e91e63;"></div>
            <span>Shopping Malls</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #16a085;"></div>
            <span>Parks</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #34495e;"></div>
            <span>Schools</span>
        </div>
        <div class="legend-item" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
            <img src="https://explore.lotfinity.tech/static/img/logo22.gif" alt="Lotfinity" style="width: 20px; height: 20px; margin-right: 8px; border-radius: 50%; object-fit: cover;">
            <span><a href="https://explore.lotfinity.tech/" target="_blank" rel="noopener noreferrer" style="color: #620c71ff; text-decoration: none; font-weight: 600;">Lotfinity - 2025</a></span>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <script>
        // Map configuration
        const centerLat = 41.009929;
        const centerLng = 28.674937;
        const radiusM = 2500;
        const amenities = {"metro": [], "metrobus": [{"id": 39, "name": "Haramidere", "distance_m": 467.27596561, "lat": 41.005981, "lng": 28.673016}, {"id": 40, "name": "G√ºzelyurt", "distance_m": 892.70426914, "lat": 41.006637, "lng": 28.665256}, {"id": 38, "name": "Haramidere Sanayi", "distance_m": 1082.14755001, "lat": 41.00423, "lng": 28.685371}, {"id": 41, "name": "Beylikd√ºz√º", "distance_m": 1497.27521, "lat": 41.009508, "lng": 28.657147}, {"id": 37, "name": "Saadetdere Mah.", "distance_m": 1896.35416301, "lat": 40.999715, "lng": 28.693001}, {"id": 42, "name": "Beylikd√ºz√º Belediye", "distance_m": 2162.82074889, "lat": 41.012418, "lng": 28.649437}], "bus": [{"id": 6179, "name": "MUSTAFA KEMALPA√ûA CADDES√ù", "distance_m": 137.43585663, "lat": 41.0089359764345, "lng": 28.6739620155107}, {"id": 397, "name": "MEHMET AK√ùF ERSOY CADDES√ù", "distance_m": 289.62489141, "lat": 41.0114369991163, "lng": 28.6721280000049}, {"id": 396, "name": "MEHMET AK√ùF ERSOY CADDES√ù", "distance_m": 290.4104624, "lat": 41.0104720005549, "lng": 28.6715599999745}, {"id": 399, "name": "MEHMET AK√ùF ERSOY CAM√ù√ù", "distance_m": 329.99049995, "lat": 41.0120300005552, "lng": 28.6721629999745}, {"id": 598, "name": "S√ùTELER", "distance_m": 365.54254632, "lat": 41.0109957872229, "lng": 28.6790478450911}, {"id": 398, "name": "MEHMET AK√ùF ERSOY CAM√ù√ù", "distance_m": 403.51971586, "lat": 41.0125229991162, "lng": 28.6715780000049}, {"id": 5574, "name": "HARAM√ùDERE", "distance_m": 433.86051398, "lat": 41.0062840005542, "lng": 28.6730809999746}, {"id": 14743, "name": "HARAM√ùDERE", "distance_m": 445.12910526, "lat": 41.0060256751778, "lng": 28.6737344104327}, {"id": 14744, "name": "HARAM√ùDERE", "distance_m": 483.25957132, "lat": 41.0061241686209, "lng": 28.6721492821011}, {"id": 14210, "name": "HARAM√ùDERE", "distance_m": 489.61586487, "lat": 41.0055439991144, "lng": 28.6743329999909}, {"id": 14663, "name": "HARAM√ùDERE", "distance_m": 492.80428166, "lat": 41.0055150804947, "lng": 28.6743336788385}, {"id": 5573, "name": "HARAM√ùDERE", "distance_m": 497.11843965, "lat": 41.0056870005538, "lng": 28.6730499999741}], "taxi": [{"id": 467, "name": "HARAMƒ∞DERE GE√áƒ∞T TAKSƒ∞ 1", "distance_m": 344.55814073, "lat": 41.0099800778, "lng": 28.6708416469}, {"id": 261, "name": "TORYUM AVM TAKSƒ∞", "distance_m": 1167.6875728, "lat": 41.0040000003, "lng": 28.6864000001}, {"id": 2, "name": "√áƒ∞√áEK TAKSƒ∞", "distance_m": 1487.52506961, "lat": 41.014897401, "lng": 28.6913589995}, {"id": 172, "name": "ADAKENT TAKSƒ∞ DURAƒûI", "distance_m": 1532.33759144, "lat": 41.0099024007, "lng": 28.6567215002}, {"id": 171, "name": "Mƒ∞GROS TAKSƒ∞", "distance_m": 1720.01201971, "lat": 41.0042157012, "lng": 28.6559332997}, {"id": 170, "name": "ALTINYILDIZ TAKSƒ∞ DURAƒûI", "distance_m": 2033.38796752, "lat": 41.0161915005, "lng": 28.6522219998}, {"id": 421, "name": "CUMHURƒ∞YET TAKSƒ∞ DURAƒûI", "distance_m": 2043.83493865, "lat": 41.0160000009, "lng": 28.6519999999}, {"id": 169, "name": "Sƒ∞TE TAKSƒ∞", "distance_m": 2111.3269479, "lat": 41.0124690009, "lng": 28.6500633006}, {"id": 44, "name": "S.S.B√úY√úK≈ûEHƒ∞R TAKSƒ∞ DURAƒûI", "distance_m": 2282.87905624, "lat": 41.0117000004, "lng": 28.6479000002}, {"id": 501, "name": "KARDE≈ûLER TAKSƒ∞", "distance_m": 2483.44016566, "lat": 41.0282577035, "lng": 28.6580215189}], "minibus": [{"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "LineString", "coordinates": [[28.697076146292755, 41.01237096207206], [28.6968162722, 41.0124892892], [28.694146336, 41.0137523533], [28.6933406513, 41.01411461569999], [28.692924593700003, 41.0143497403], [28.6926442127, 41.01454739609999], [28.692209468800005, 41.0149168706], [28.690870492, 41.016225117699996], [28.6904141175, 41.01669562149999], [28.6901158387, 41.01703015679999], [28.6899432191, 41.017279957899994], [28.68941352, 41.01818054259999], [28.686297626200002, 41.02330081139999], [28.685431071, 41.024754427399984], [28.6853894599337, 41.024834467403736]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "LineString", "coordinates": [[28.69707567291734, 41.01237458872246], [28.696380024300005, 41.012719622199995], [28.6941459596, 41.0137714084], [28.693200740499996, 41.014306748299994], [28.692806306, 41.014567206399995], [28.692529409599988, 41.014787146399996], [28.690889739599996, 41.0163177832], [28.6906808298, 41.016532910999985], [28.69041374, 41.0167146765], [28.690115461099992, 41.01704921180001], [28.689942841499995, 41.0172990129], [28.689104202100005, 41.018719371899984], [28.6875740326, 41.0212093066], [28.685430692, 41.02477348239999], [28.68540151429136, 41.024829606500205]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "MultiLineString", "coordinates": [[[28.6941651008, 41.001433722499996], [28.6946435662, 41.0030602771], [28.693602541599994, 41.0032677509], [28.692502463799997, 41.003439408799984], [28.69182302059999, 41.003674515899995], [28.690712867200002, 41.0043038046], [28.690361379899997, 41.00469052019999], [28.689890531499994, 41.00630935459999], [28.6881928328, 41.00581353649999], [28.685877311899997, 41.00510533549999], [28.6847663952, 41.0047962753], [28.684008660599996, 41.00511115169999], [28.683108661300004, 41.005639697499994], [28.682875015599993, 41.006055697399994], [28.6823691102, 41.00589725319999], [28.682115501, 41.0059552063], [28.681841959099998, 41.009353269599984], [28.681344539799994, 41.01113775159999], [28.6813403287, 41.0116127549], [28.682209703, 41.014507056199996], [28.6827488897, 41.01606566389999], [28.682795175099997, 41.0174845841], [28.682937496099996, 41.018378577399986], [28.6837511003, 41.019617406], [28.684125533399996, 41.0198960727], [28.683981909499998, 41.02003166139999], [28.683803425900003, 41.01989621039999], [28.6828594091, 41.018573273], [28.682750031199994, 41.0180679601], [28.6825898279, 41.01612612649999], [28.682189383100003, 41.0146976245], [28.6804832804, 41.01595288339999], [28.67806259399999, 41.017979122899995], [28.676185725899998, 41.01969728609999], [28.6701894113, 41.02466896459999], [28.66854810064847, 41.026088474167494]], [[28.68918723406059, 41.02292015020312], [28.689044325500003, 41.02283792909999], [28.688906056600004, 41.02270389529999], [28.6888335816, 41.02255155139999], [28.688685937399995, 41.0223192568], [28.688298396, 41.0219384292], [28.687722057600002, 41.0214973209], [28.687516685, 41.021384439399995], [28.6874523302, 41.02133034089999], [28.687409700800004, 41.021259337500005], [28.687420581599998, 41.0211666544], [28.688245521, 41.0197905247], [28.68866787769999, 41.019113372899994], [28.689721246699992, 41.017347498499994], [28.6900003858, 41.016951622], [28.690479791599998, 41.0164362701], [28.692393990700005, 41.0146213386], [28.692776489900005, 41.014353584599995], [28.6931822524, 41.01411399109999], [28.6938513735, 41.013807701499985], [28.694782155099997, 41.01333104369999], [28.697094388517606, 41.01223120355897]]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "MultiLineString", "coordinates": [[[28.697075994434396, 41.01237212549786], [28.6941434708, 41.01375381009999], [28.693646815100003, 41.01397322019999], [28.693284673299996, 41.014152504], [28.692855702, 41.01439404159999], [28.692577422800003, 41.01459672379999], [28.692218803899998, 41.014907338299984], [28.690870492, 41.016225117699996], [28.6901158387, 41.01703015679999], [28.6899432191, 41.017279957899994], [28.6890315837, 41.018810530799996], [28.689027232399997, 41.01885537569999], [28.689071084, 41.018886463899996], [28.6892611327, 41.01895937479999], [28.6895459875, 41.019055138599995], [28.690025416099992, 41.0181842994], [28.690226836900003, 41.0182997914], [28.693853648400005, 41.01890126089999], [28.693895965996735, 41.01893977760502]], [[28.668531214947308, 41.026084609908324], [28.6697722202, 41.0249564152], [28.6700053551, 41.024830572099994], [28.669854445, 41.024655674], [28.6697149793, 41.023930511799996], [28.669538561099994, 41.021938866199996], [28.669574367499994, 41.0215703309], [28.669798079, 41.0209091084], [28.6699578286, 41.02068668479999], [28.670195341300005, 41.02045118559999], [28.6706850385, 41.0202371744], [28.671059604499995, 41.0200204145], [28.671173638100004, 41.01993530829999], [28.6718289993, 41.01938576739999], [28.672101811800005, 41.019186682699996], [28.6722009526, 41.018902616599995], [28.672308731299996, 41.018979135799995], [28.675363829200002, 41.020320516], [28.6768262222, 41.0190822596], [28.678803232699995, 41.01736207409999], [28.6794685478, 41.01672289469999], [28.6804139038, 41.015772896799994], [28.6807183293, 41.0154285776], [28.681334747900003, 41.01497538240001], [28.682209703, 41.014507056199996], [28.681639457, 41.0126365189], [28.681120927500004, 41.011444927499994], [28.6811387001, 41.0112244648], [28.681495393400002, 41.0099515712], [28.681636385699992, 41.0097944728], [28.681932097599994, 41.00742269009999], [28.684063513400005, 41.007947953199995], [28.688303596, 41.008936626499995], [28.688656349, 41.009125619399995], [28.690361379899997, 41.00469052019999], [28.690672224100002, 41.00439910539998], [28.690712867200002, 41.0043038046], [28.691391908900002, 41.00387972629999], [28.69182302059999, 41.003674515899995], [28.692502463799997, 41.003439408799984], [28.693602541599994, 41.0032677509], [28.6946435662, 41.0030602771], [28.6941651008, 41.001433722499996]]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "MultiLineString", "coordinates": [[[28.693015324511737, 40.99996637272858], [28.6929868166, 40.999968088399996], [28.692140919499998, 41.0000790414], [28.691531088299993, 41.00020858169999], [28.691237952599995, 41.0002939224], [28.690611363199995, 41.0005302153], [28.690226750199997, 41.0007153551], [28.690013087599997, 41.000843321699996], [28.6892681161, 41.00136591119999], [28.687640067199997, 41.002699237899996], [28.6864357383, 41.00371303279999], [28.685669252299995, 41.0042884661], [28.685041639100003, 41.004685381099996], [28.6845315323, 41.004954726699985], [28.684177974100002, 41.0051007805], [28.6831138278, 41.00544409329999], [28.6821985384, 41.00570405909999], [28.6817223153, 41.005809464699986], [28.6808143784, 41.005952482], [28.6800280282, 41.0060182575], [28.679055844500002, 41.006066745399984], [28.678041386599997, 41.00610110409999], [28.6768953819, 41.006123237599994], [28.675834621799993, 41.00612558259999], [28.6724620914, 41.00620262679999], [28.671201836299996, 41.0062063426], [28.6698623999, 41.0062856761], [28.6677517231, 41.006326434799995], [28.666910730799998, 41.0064098028], [28.665527881199996, 41.00670168359999], [28.664773852300005, 41.0068978355], [28.663678606, 41.007228428599994], [28.6633135881, 41.007355678], [28.662247279399995, 41.007764054199995], [28.660775289, 41.008371120799985], [28.658732447, 41.00918686619999], [28.6584017382, 41.009294535799995], [28.657360610600005, 41.009703159500006], [28.6557512059, 41.0102911714], [28.655073985599998, 41.01052320349999], [28.653851722300004, 41.011002253899996], [28.653493346799998, 41.0111619414], [28.652678698859454, 41.01145807988806]], [[28.65313339875188, 41.013789137801794], [28.653850924, 41.0135119966], [28.6565118275, 41.01246452929999], [28.656665491599995, 41.0123344395], [28.656792683700004, 41.01232247149999], [28.656864455099992, 41.0123488053], [28.656914751799995, 41.0123956842], [28.6569341234, 41.012454741199996], [28.6569290838, 41.0125370535], [28.656982722799995, 41.012650685699995], [28.6580322377, 41.0141995237], [28.658155639100002, 41.0143087858], [28.6583985006, 41.01441127609999], [28.658462740700003, 41.014452003699994], [28.658495760199997, 41.01449442180001], [28.6585094715, 41.01453174649999], [28.6584893481, 41.014624425499996], [28.658358089, 41.014754365199984], [28.6583339249, 41.01480590069999], [28.6583548641, 41.014901630199994], [28.6585123241, 41.015133677], [28.6589072658, 41.01549594909999], [28.658969990700005, 41.015578803299995], [28.659009603799998, 41.015645442899995], [28.6590251877, 41.015715138], [28.659014471299997, 41.0157777028], [28.6589122382, 41.015945015399986], [28.658889889299992, 41.016050246599995], [28.658903148700002, 41.016083089], [28.659445275799992, 41.01673292929999], [28.659445761900002, 41.01675544839999], [28.659409676, 41.0167929969], [28.659132364, 41.01691618689999], [28.6591196795, 41.01693557949999], [28.659130759599996, 41.016978591199994], [28.6591592853, 41.0169989351], [28.6598646822, 41.0172233009], [28.660810244699995, 41.01760230219999], [28.6609712357, 41.0176381513], [28.661095319399994, 41.017599569099986], [28.663148593499994, 41.016122857499994], [28.663830886599996, 41.015668586499984], [28.665391755800005, 41.01469560009999], [28.6657360766, 41.014466111599994], [28.666067148, 41.0142698225], [28.666357251099992, 41.0141196841], [28.666669113700003, 41.0138640651], [28.666741342500003, 41.0138508918], [28.666831594, 41.01386791759999], [28.6668806666, 41.01391624659999], [28.666893658899994, 41.01399524189999], [28.667115242800005, 41.017560429099994], [28.6670689164, 41.01764280009999], [28.6662855293, 41.017713427099984], [28.665082918699998, 41.0177650191], [28.6650131306, 41.01784860669999], [28.6649522219, 41.0184038577], [28.664949691399993, 41.01908995139999], [28.6647496399, 41.01974373649999], [28.6647085711, 41.020094895], [28.6648101693, 41.0211015833], [28.664825433699995, 41.02145326839999], [28.664748404799997, 41.022498431200006], [28.664778481499994, 41.023187439599994], [28.664831926799994, 41.02376941859999], [28.664819785, 41.0238721966], [28.6647571042, 41.024109708499985], [28.66431655377199, 41.02476672712397]], [[28.66849846915302, 41.02607711609767], [28.669099859, 41.025510512299995], [28.669819343700002, 41.02490903759999], [28.670000793699995, 41.024807020199994], [28.671232383799993, 41.02380114409999], [28.6730255042, 41.0222286545], [28.675165381500005, 41.02046172229999], [28.675472526900002, 41.020169427499994], [28.6766809566, 41.019142117799994], [28.6766876517, 41.019082635], [28.676647795299996, 41.0190309566], [28.676077461600002, 41.01884391459999]]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "LineString", "coordinates": [[28.69707615132277, 41.01237092353586], [28.6941434708, 41.01375381009999], [28.6933406513, 41.01411461569999], [28.692896870300004, 41.014366634], [28.692690203700003, 41.01451080659999], [28.692218803899998, 41.014907338299984], [28.690870492, 41.016225117699996], [28.6904141175, 41.01669562149999], [28.6901158387, 41.01703015679999], [28.6899432191, 41.017279957899994], [28.68941352, 41.01818054259999], [28.686262335899997, 41.0233594447], [28.685431071, 41.024754427399984], [28.6853894599337, 41.024834467403736]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "LineString", "coordinates": [[28.685229477952216, 41.02489897988879], [28.685685681299994, 41.024065831799994], [28.687420581599998, 41.0211666544], [28.6884391195, 41.01951873449999], [28.688968778600003, 41.0185922046], [28.6898636926, 41.017156364199984], [28.690036435699998, 41.016915324], [28.690479791599998, 41.0164362701], [28.69189685, 41.015119170499986], [28.692393990700005, 41.0146213386], [28.692828140600003, 41.0143101962], [28.693514764699998, 41.01394394689999], [28.6938513735, 41.013807701499985], [28.694708791800004, 41.013366644199984], [28.69709375247442, 41.01223607645913]]}}, {"id": "BL101", "name": "B√úY√úK√áEKMECE - ESENYURT", "geometry": {"type": "MultiLineString", "coordinates": [[[28.686235572900003, 41.02043959089999], [28.6863672703, 41.02004361209999], [28.686578395899996, 41.01929901149999], [28.686835978399994, 41.018204324], [28.6871377894, 41.017540729499984], [28.687620947099994, 41.01660563859999], [28.687754484799992, 41.01645079899998], [28.687986501400005, 41.01627819579999], [28.688970578400003, 41.01577545479999], [28.689912844799995, 41.0153526293], [28.6900370276, 41.015240061099995], [28.690139000899993, 41.01508273849999], [28.6905630978, 41.01405392029999], [28.6907832809, 41.01358557349999], [28.691204275, 41.01250571709999], [28.69170897049999, 41.011511490899984], [28.691957791100002, 41.0109398146], [28.692230967199997, 41.01006947709999], [28.692388771099992, 41.01005761710001], [28.6917489333, 41.00925345630001], [28.693198604300004, 41.0085451107], [28.693345152800003, 41.008517228299986], [28.694538030199997, 41.0079463029], [28.69586034, 41.00725389229999], [28.6962931603, 41.007066873399985], [28.696617022699996, 41.00690655019999], [28.696647170100004, 41.006835326699985], [28.696632350099996, 41.006761379699995], [28.6961530935, 41.00612075799999], [28.696155262599994, 41.006065958899995], [28.6961918222, 41.006014479899996], [28.6962335226, 41.00598928569998], [28.696654599672367, 41.005854688278944]], [[28.69303381135512, 40.99998337353728], [28.692992705800002, 40.9999869715], [28.692017187, 41.00011326009999], [28.691531088299993, 41.00020858169999], [28.691237952599995, 41.0002939224], [28.690611363199995, 41.0005302153], [28.690226750199997, 41.0007153551], [28.690013087599997, 41.000843321699996], [28.6892681161, 41.00136591119999], [28.687640067199997, 41.002699237899996], [28.6864357383, 41.00371303279999], [28.685827522099995, 41.0041772616], [28.685397374799994, 41.004457487799996], [28.685072415800004, 41.00464155089999], [28.6846297064, 41.0048607799], [28.684058374899994, 41.0050926555], [28.6831138278, 41.00544409329999], [28.6821985384, 41.00570405909999], [28.6817223153, 41.005809464699986], [28.6808143784, 41.005952482], [28.6800280282, 41.0060182575], [28.679055844500002, 41.006066745399984], [28.678041386599997, 41.00610110409999], [28.6768953819, 41.006123237599994], [28.675834621799993, 41.00612558259999], [28.6752588909, 41.00615285669999], [28.6724620914, 41.00620262679999], [28.671201836299996, 41.0062063426], [28.6705952378, 41.0062265815], [28.6698623999, 41.0062856761], [28.668439277599997, 41.006312144499994], [28.667499496399998, 41.006348802], [28.66660877289999, 41.006452483699995], [28.665907908900003, 41.006578126099996], [28.664726877, 41.006872766299985], [28.664215598600002, 41.007036068], [28.6633135881, 41.007355678], [28.662247279399995, 41.007764054199995], [28.659745310799995, 41.00879727939999], [28.6588915459, 41.00913506749999], [28.6584017382, 41.009294535799995], [28.657360610600005, 41.009703159500006], [28.6557512059, 41.0102911714], [28.655073985599998, 41.01052320349999], [28.653820472199996, 41.0109901653], [28.653493346799998, 41.0111619414], [28.652678698859454, 41.01145807988806]]]}}, {"id": "BL101", "name": "B√úY√úK√áEKMECE - ESENYURT", "geometry": {"type": "MultiLineString", "coordinates": [[[28.652613799290293, 41.01096085887229], [28.654141976499997, 41.01037165689999], [28.654482394300004, 41.01027693769999], [28.655570938, 41.0098562261], [28.656983650899996, 41.00926789849999], [28.657901551899993, 41.0090009661], [28.658821871700003, 41.0086764128], [28.6589773777, 41.00863496219999], [28.6615464618, 41.0076273074], [28.661861629, 41.0075160312], [28.6624993357, 41.0073410358], [28.6630928543, 41.007118902], [28.6644494075, 41.006678885599996], [28.664861225199996, 41.006559250399995], [28.665650179, 41.00636192649999], [28.6665601975, 41.00619040129999], [28.667175723, 41.006109194599986], [28.667640689699997, 41.006060494699994], [28.6682578346, 41.00601715309999], [28.669373242600003, 41.00595765819999], [28.6712295242, 41.00579007489999], [28.671591112199998, 41.00579423779999], [28.6733551134, 41.0057514599], [28.673836512800005, 41.00575890919999], [28.676674055600003, 41.00564899969999], [28.677976594637958, 41.0056080169577]], [[28.677976594637958, 41.0056080169577], [28.6795588138, 41.005558234399984], [28.6796831709, 41.005492904], [28.679760427399994, 41.0054178235], [28.679814054, 41.005318862], [28.6798419541, 41.0051817338], [28.679823693699998, 41.005101449499996], [28.679746704500005, 41.0049718998], [28.679636534799997, 41.00485204759999], [28.6795037292, 41.004745490199994], [28.679238454, 41.00460806049999], [28.679005493699997, 41.00454124129999], [28.678740297699996, 41.0044945459], [28.678616816199998, 41.004492599], [28.678460509299995, 41.0045119948], [28.678276685499995, 41.00457455299998], [28.678098496400004, 41.00468136669999], [28.6779698177, 41.004863897], [28.677901393400003, 41.005063619599994], [28.677976594637958, 41.0056080169577]], [[28.677976594637958, 41.0056080169577], [28.6780074612, 41.0058314651], [28.678078138638107, 41.006089573907396]], [[28.678078138638107, 41.006089573907396], [28.67820366, 41.0065479662], [28.678332207499995, 41.00669571329999], [28.678517272600004, 41.00679666559999], [28.6787132013, 41.0068289016], [28.679001563, 41.00682005229999], [28.679337333100005, 41.0067459881], [28.6794429658, 41.00670154489999], [28.6795224498, 41.0066347632], [28.6795601186, 41.006575902399995], [28.6795785131, 41.006437403899994], [28.6795248563, 41.0063004462], [28.679473665299998, 41.006240448499994], [28.679371316699996, 41.00616676869999], [28.6791685683, 41.0061114929], [28.678873921500003, 41.006076801499994], [28.678078138638107, 41.006089573907396]], [[28.678078138638107, 41.006089573907396], [28.675834621799993, 41.00612558259999], [28.6752588909, 41.00615285669999], [28.671731994100004, 41.00620478039999], [28.667868485599993, 41.00633193639999], [28.666910730799998, 41.0064098028], [28.66660877289999, 41.006452483699995], [28.666205616399996, 41.007910167], [28.6661136346, 41.0083596387], [28.666244185800004, 41.0089227474], [28.6661176749, 41.0106217301], [28.6681662322, 41.010724517199996], [28.668131904599992, 41.01110684719999], [28.6677867761, 41.01183157239999], [28.667429164799994, 41.012493612899995], [28.667277587799997, 41.01267782459999], [28.667047761400003, 41.0129149522], [28.666935273699995, 41.01308357879999], [28.666867157799995, 41.01326884979999], [28.6668109083, 41.013623948], [28.66669255639999, 41.0138848012], [28.666357251099992, 41.0141196841], [28.666067148, 41.0142698225], [28.6657360766, 41.014466111599994], [28.665391755800005, 41.01469560009999], [28.663830886599996, 41.015668586499984], [28.663372396600003, 41.015976995599985], [28.6633358472, 41.0160301363], [28.663335018, 41.016098432099994], [28.6633611942, 41.0161428368], [28.664506542299996, 41.0174107749], [28.6649013663, 41.0177965271], [28.664956932500004, 41.01792121889999], [28.664979752200004, 41.018051682199996], [28.6649522219, 41.0184038577], [28.664949691399993, 41.01908995139999], [28.664786982299994, 41.019576925799996], [28.6647496399, 41.01974373649999], [28.6647085711, 41.020094895], [28.6647300375, 41.0204339164], [28.6648101693, 41.0211015833], [28.664825433699995, 41.02145326839999], [28.664748404799997, 41.022498431200006], [28.6647951634, 41.0237821929], [28.664718140200005, 41.0241067521], [28.664409471099997, 41.024555961299995], [28.664336439096267, 41.02477474586172]]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "MultiLineString", "coordinates": [[[28.676077461600002, 41.01884391459999], [28.676754987500004, 41.01906595429999], [28.6768163817, 41.0191329406], [28.6768018866, 41.0192137423], [28.675699555600005, 41.02011566719999], [28.6753153987, 41.02039195649999], [28.6739064943, 41.021506446299995], [28.673315392, 41.02202607539999], [28.6726889435, 41.02251916219999], [28.671232383799993, 41.02380114409999], [28.6705956295, 41.02431139749999], [28.6700053551, 41.024830572099994], [28.6698482124, 41.02501535], [28.668649263200003, 41.0260482118], [28.668596036063935, 41.02609944409092]], [[28.66429375715629, 41.02475753440957], [28.664409471099997, 41.024555961299995], [28.664718140200005, 41.0241067521], [28.6647951634, 41.0237821929], [28.664748404799997, 41.022498431200006], [28.664825433699995, 41.02145326839999], [28.6648101693, 41.0211015833], [28.6647300375, 41.0204339164], [28.6647085711, 41.020094895], [28.664760658500004, 41.0195705645], [28.664949691399993, 41.01908995139999], [28.664963720800003, 41.01827679669999], [28.6650084069, 41.0178164275], [28.665101496099997, 41.01774090829999], [28.666291409, 41.017694641099986], [28.6670239457, 41.017641475], [28.6670836402, 41.017599282599996], [28.667117999599995, 41.0175264123], [28.666893658899994, 41.01399524189999], [28.666849114600005, 41.013929322299994], [28.666809406299997, 41.013909803599994], [28.6667157821, 41.01392119949999], [28.666357251099992, 41.0141196841], [28.665391755800005, 41.01469560009999], [28.663830886599996, 41.015668586499984], [28.6628609542, 41.0163482271], [28.662465715099998, 41.016605706099995], [28.661488691299997, 41.0173233694], [28.6611846103, 41.017573156], [28.661048607500003, 41.017641142], [28.660878539899993, 41.017630755099994], [28.6595987765, 41.01714418], [28.659144133700003, 41.0169960638], [28.659119230600005, 41.01690513359999], [28.6594562345, 41.016727992799986], [28.658903148700002, 41.016083089], [28.658888945800005, 41.01599425429998], [28.6589746904, 41.01584481510001], [28.659010576899995, 41.015719789799995], [28.658969990700005, 41.015578803299995], [28.658809950900004, 41.01540541149999], [28.658511116200003, 41.015144993], [28.658008581, 41.014359074], [28.656820536499996, 41.0126268063], [28.656738633599996, 41.01258049899999], [28.656560333300003, 41.01257503419998], [28.6543504027, 41.013420421599996], [28.653902045, 41.013610000099995], [28.653172670359293, 41.01388682284824]], [[28.65261357605102, 41.010959148542376], [28.654141976499997, 41.01037165689999], [28.654482394300004, 41.01027693769999], [28.6561889497, 41.0096220672], [28.656302785400005, 41.00953000479999], [28.656983650899996, 41.00926789849999], [28.6573084617, 41.00921881179999], [28.657901551899993, 41.0090009661], [28.6589773777, 41.00863496219999], [28.661671137099994, 41.00758315219999], [28.66190870979999, 41.00744938070001], [28.663203931899993, 41.006976892699996], [28.664460212100003, 41.00657564709999], [28.664975354199992, 41.0064334248], [28.6652980028, 41.00634878659999], [28.6661053259, 41.00617330419999], [28.666881835499996, 41.00605172129998], [28.667370805800005, 41.00599248409999], [28.6678984437, 41.005953899199994], [28.670005926400002, 41.00581922679999], [28.67294573179999, 41.00575756279999], [28.673836512800005, 41.00575890919999], [28.677794692500004, 41.005613749799984], [28.680523834900004, 41.005534495899994], [28.681284412, 41.005456676899996], [28.682204078899996, 41.00527612689999], [28.683044185399993, 41.00502796919999], [28.683921869499994, 41.00468470069998], [28.684277091700004, 41.00453013319999], [28.684635195399995, 41.004350363899995], [28.685453553200002, 41.00387843019999], [28.685774306899994, 41.003662185299994], [28.6862019753, 41.0033335979], [28.686491169299998, 41.00302866449999], [28.687892704600003, 41.00194329509999], [28.6889837642, 41.001034630499994], [28.689399150500005, 41.0007239179], [28.6899770306, 41.00037719309999], [28.6904142324, 41.00016586209999], [28.690857890599993, 40.999988846099995], [28.691688884499996, 40.999715284], [28.692042777099992, 40.999625569399996], [28.6924463376, 40.99955083849999], [28.69255010941649, 40.99953855174457]]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "LineString", "coordinates": [[28.697075889140677, 41.01237293218007], [28.6968162722, 41.0124892892], [28.6941434708, 41.01375381009999], [28.693646815100003, 41.01397322019999], [28.6931185872, 41.0142399558], [28.692887848, 41.0143767092], [28.6924847415, 41.01468065569999], [28.6917517241, 41.01536576669999], [28.690870492, 41.016225117699996], [28.6904141175, 41.01669562149999], [28.6901158387, 41.01703015679999], [28.6899432191, 41.017279957899994], [28.68941352, 41.01818054259999], [28.686262335899997, 41.0233594447], [28.685431071, 41.024754427399984], [28.6853894599337, 41.024834467403736]]}}, {"id": "A43", "name": "AVCILAR - ESENYURT", "geometry": {"type": "MultiLineString", "coordinates": [[[28.697074552507534, 41.01238317246838], [28.697035134200004, 41.01240495439998], [28.696951453199997, 41.01250168589999], [28.696942629200002, 41.01255042539999], [28.696965915900005, 41.012630816], [28.697033411040696, 41.0126983669888]], [[28.66854675450209, 41.026088166104586], [28.668625628099996, 41.02600608880001], [28.6700053551, 41.024830572099994], [28.6697149793, 41.023930511799996], [28.669679140800003, 41.0233666639], [28.6695403213, 41.0220452764], [28.6694549229, 41.02180404779999], [28.6698320865, 41.02083889669999], [28.670195341300005, 41.02045118559999], [28.669203541199998, 41.0198154172], [28.6686182996, 41.0195068815], [28.668527160600004, 41.012609529399995], [28.6703010661, 41.01257625629999], [28.6720083857, 41.0123764432], [28.672371155400004, 41.0122751179], [28.6720000317, 41.01142109229998], [28.6716723083, 41.01051826529999], [28.671555217200005, 41.0102983153], [28.6711336581, 41.00970912979999], [28.670402201199998, 41.009172756399984], [28.671705119299993, 41.009181626899995], [28.672297555199993, 41.00916737619998], [28.672971724500005, 41.00904863609999], [28.675050889200005, 41.0085298632], [28.675897741, 41.00828388219999], [28.676218757900003, 41.0081668693], [28.676281327299996, 41.008104968599994], [28.676269700533545, 41.00806937194164]], [[28.676269700533545, 41.00806937194164], [28.676035609199996, 41.0073526708], [28.6760860987, 41.007202007699995], [28.6758829538, 41.006826982899995], [28.675363351200005, 41.0064745775], [28.6750107122, 41.0063393981], [28.674312084899995, 41.0063997211], [28.6738801278, 41.0063322871], [28.673553352499997, 41.006179208599995], [28.671201836299996, 41.0062063426], [28.670985905099993, 41.00795885419999], [28.671687641799995, 41.007896190299995], [28.6722225034, 41.00794810259998], [28.67264673069999, 41.00819612829999], [28.672799875800003, 41.008321706299995], [28.6728828664, 41.0084523668], [28.6728712382, 41.008978151399994], [28.675066093, 41.0084688368], [28.6758320213, 41.00823802739999], [28.676269700533545, 41.00806937194164]], [[28.676269700533545, 41.00806937194164], [28.6763476825, 41.00803932229999], [28.6763709251, 41.0079452171], [28.6763318722, 41.007731149099996], [28.676180622799997, 41.007339457], [28.676457107700003, 41.0073585206]]]}}], "grocery": [{"id": 2663, "name": "A101", "distance_m": 840.94703955, "lat": 41.002596, "lng": 28.6724433}, {"id": 666, "name": "A101", "distance_m": 840.94703955, "lat": 41.002596, "lng": 28.6724433}, {"id": 1968, "name": "Migros", "distance_m": 1450.43472406, "lat": 41.0063429, "lng": 28.6583582}, {"id": 3965, "name": "Migros", "distance_m": 1450.43472406, "lat": 41.0063429, "lng": 28.6583582}, {"id": 54, "name": "Migros", "distance_m": 1739.87976717, "lat": 41.0117978, "lng": 28.6544017}, {"id": 2051, "name": "Migros", "distance_m": 1739.87976717, "lat": 41.0117978, "lng": 28.6544017}, {"id": 1003, "name": "Bƒ∞M", "distance_m": 1757.97206594, "lat": 41.0062343, "lng": 28.654617}, {"id": 3000, "name": "Bƒ∞M", "distance_m": 1757.97206594, "lat": 41.0062343, "lng": 28.654617}, {"id": 3140, "name": "A101", "distance_m": 1797.18373181, "lat": 41.0236365, "lng": 28.6862939}, {"id": 1143, "name": "A101", "distance_m": 1797.18373181, "lat": 41.0236365, "lng": 28.6862939}, {"id": 2349, "name": "Bƒ∞M", "distance_m": 1803.58920253, "lat": 41.0146565, "lng": 28.6544247}, {"id": 352, "name": "Bƒ∞M", "distance_m": 1803.58920253, "lat": 41.0146565, "lng": 28.6544247}], "clothing": [{"id": 47, "name": "Mavi", "distance_m": 1286.87354307, "lat": 41.0043679, "lng": 28.6883573}], "malls": [{"id": 12, "name": "Marmara Park", "distance_m": 407.19968465, "lat": 41.0118, "lng": 28.6791}], "parks": [{"id": 1, "name": "Recep Tayyip Erdoƒüan Park", "distance_m": 247.46522757, "lat": 41.0121, "lng": 28.6756}, {"id": 7, "name": "Harman Park", "distance_m": 505.20558649, "lat": 41.0127, "lng": 28.6797}, {"id": 4, "name": "Gaziler Parkƒ± (Veterans' Park)", "distance_m": 527.94813036, "lat": 41.0069, "lng": 28.6701}, {"id": 2, "name": "≈ûehitler Parkƒ± (Martyrs' Park)", "distance_m": 1759.2107578, "lat": 41.0189, "lng": 28.6577}, {"id": 3, "name": "Mehmet Akif Ersoy Parkƒ±", "distance_m": 1919.49880938, "lat": 41.0187, "lng": 28.6946}], "schools": []};
        
        // Initialize map
        const map = L.map('map').setView([centerLat, centerLng], 15);
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        
        // Add center marker with Font Awesome icon
        const centerIcon = L.divIcon({
            html: '<div style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;"><i class="fas fa-map-marker-alt" style="font-size: 40px; color: #e23116ff; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));"></i></div>',
            className: '',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
        });
        
        L.marker([centerLat, centerLng], { icon: centerIcon })
            .addTo(map)
            .bindPopup('<div class="popup-title">üìç Your Location</div><div class="popup-info">41.009929,28.674937</div>');
        
        // Add radius circle
        L.circle([centerLat, centerLng], {
            radius: radiusM,
            color: '#667eea',
            fillColor: '#667eea',
            fillOpacity: 0.1,
            weight: 2
        }).addTo(map);
        
        // Color mapping for different amenity types
        const colors = {
            metro: '#e74c3c',
            metrobus: '#e67e22',
            bus: '#3498db',
            taxi: '#f39c12',
            minibus: '#1abc9c',
            grocery: '#27ae60',
            clothing: '#9b59b6',
            malls: '#e91e63',
            parks: '#16a085',
            schools: '#34495e'
        };
        
        // Create metro station icon using Istanbul Metro logo
        function createMetroIcon() {
            return L.icon({
                iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/4/4f/Istanbul_Metro_Logo.svg',
                iconSize: [24, 24],
                iconAnchor: [12, 12],
                popupAnchor: [0, -12],
                className: 'metro-icon',
                crossOrigin: 'anonymous'
            });
        }
        
        // Icon mapping for different amenity types
        const icons = {
            metro: 'üöá',
            metrobus: 'üöå',
            bus: 'üöè',
            taxi: 'üöï',
            minibus: 'üöê',
            grocery: 'üõí',
            clothing: 'üëï',
            malls: 'üè¨',
            parks: 'üå≥',
            schools: 'üè´'
        };
        
        // Add amenities to map
        Object.keys(amenities).forEach(type => {
            const items = amenities[type];
            const color = colors[type] || '#95a5a6';
            const icon = icons[type] || 'üìç';
            
            items.forEach(item => {
                let marker;
                const distanceKm = (item.distance_m / 1000).toFixed(2);
                const distanceM = Math.round(item.distance_m);
                const distanceText = distanceM < 1000 ? `${distanceM}m` : `${distanceKm}km`;
                
                // Use special icons for different amenity types
                if (type === 'metro') {
                    marker = L.marker([item.lat, item.lng], { icon: createMetroIcon() });
                } else if (type === 'bus' || type === 'metrobus') {
                    const markerIcon = L.divIcon({
                        html: `<div style="background-color: ${color}; width: 28px; height: 28px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-bus" style="color: white; font-size: 14px;"></i></div>`,
                        className: '',
                        iconSize: [28, 28],
                        iconAnchor: [14, 14]
                    });
                    marker = L.marker([item.lat, item.lng], { icon: markerIcon });
                } else if (type === 'minibus') {
                    // Minibus lines are LineStrings, render them as paths (not point markers)
                    if (item.geometry) {
                        const lineStyle = {
                            color: color,
                            weight: 8,
                            opacity: 0.9,
                            dashArray: '10, 5'
                        };
                        const line = L.geoJSON(item.geometry, { 
                            style: lineStyle,
                            onEachFeature: function(feature, layer) {
                                layer.bindPopup(`
                                    <div class="popup-title">${icon} ${item.name}</div>
                                    <div class="popup-info">Type: <strong>Minibus Line</strong></div>
                                    <div class="popup-info">Route ID: ${item.id || 'N/A'}</div>
                                `);
                            }
                        });
                        line.addTo(map);
                    }
                    return; // Skip the regular marker creation below
                } else if (type === 'taxi') {
                    const markerIcon = L.divIcon({
                        html: `<div style="background-color: ${color}; width: 28px; height: 28px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-taxi" style="color: white; font-size: 14px;"></i></div>`,
                        className: '',
                        iconSize: [28, 28],
                        iconAnchor: [14, 14]
                    });
                    marker = L.marker([item.lat, item.lng], { icon: markerIcon });
                } else if (type === 'grocery' || type === 'clothing') {
                    const markerIcon = L.divIcon({
                        html: `<div style="background-color: ${color}; width: 28px; height: 28px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-shopping-cart" style="color: white; font-size: 14px;"></i></div>`,
                        className: '',
                        iconSize: [28, 28],
                        iconAnchor: [14, 14]
                    });
                    marker = L.marker([item.lat, item.lng], { icon: markerIcon });
                } else {
                    const markerIcon = L.divIcon({
                        html: `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; font-size: 12px;">${icon}</div>`,
                        className: '',
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    });
                    marker = L.marker([item.lat, item.lng], { icon: markerIcon });
                }
                
                marker.addTo(map)
                    .bindPopup(`
                        <div class="popup-title">${icon} ${item.name}</div>
                        <div class="popup-info">Type: <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong></div>
                        <div class="popup-info">Distance: <span class="popup-distance">${distanceText}</span></div>
                    `);
            });
        });
        
        // Fit bounds to show all markers
        setTimeout(() => {
            map.fitBounds([
                [centerLat - (radiusM / 111320), centerLng - (radiusM / (111320 * Math.cos(centerLat * Math.PI / 180)))],
                [centerLat + (radiusM / 111320), centerLng + (radiusM / (111320 * Math.cos(centerLat * Math.PI / 180)))]
            ], { padding: [50, 50] });
        }, 100);
    </script>
</body>
</html>
